<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Research Chatbot</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        .header h1 {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 5px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #666;
            font-size: 0.9em;
        }

        .main-container {
            flex: 1;
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            gap: 20px;
            padding: 20px;
            min-height: 0;
        }

        .article-panel {
            width: 350px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
        }

        .url-input-section {
            margin-bottom: 20px;
        }

        .url-input-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .url-input-section input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .url-input-section input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-load {
            width: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .btn-load:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-load:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .article-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            flex-shrink: 0;
        }

        .article-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .article-url {
            color: #667eea;
            text-decoration: none;
            font-size: 0.85em;
            word-break: break-all;
        }

        .article-summary {
            flex: 1;
            overflow-y: auto;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            line-height: 1.5;
            font-size: 0.9em;
            color: #333;
        }

        .chat-container {
            flex: 1;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            min-height: 0;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e1e5e9;
            text-align: center;
        }

        .chat-header h2 {
            color: #333;
            font-size: 1.3em;
            margin-bottom: 5px;
        }

        .chat-status {
            color: #666;
            font-size: 0.9em;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.4;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.bot {
            align-self: flex-start;
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e1e5e9;
            border-bottom-left-radius: 5px;
        }

        .message.typing {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            align-self: flex-start;
            padding: 15px 20px;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-input-container {
            padding: 20px;
            border-top: 1px solid #e1e5e9;
            background: white;
            border-radius: 0 0 15px 15px;
        }

        .chat-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            min-height: 44px;
            transition: all 0.3s ease;
        }

        .chat-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-send {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .btn-send:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-send:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .empty-state {
            text-align: center;
            color: #666;
            padding: 40px 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .empty-state .icon {
            font-size: 3em;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .loading-article {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                padding: 10px;
                gap: 15px;
            }
            
            .article-panel {
                width: 100%;
                order: 2;
            }
            
            .chat-container {
                order: 1;
                min-height: 60vh;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>🤖 News Research Chatbot</h1>
        <p>Load an article and chat about it with AI</p>
    </div>

    <div class="main-container">
        <div class="article-panel">
            <div class="url-input-section">
                <label for="newsUrl">News Article URL</label>
                <input type="url" id="newsUrl" placeholder="https://example.com/news-article" />
            </div>
            
            <button class="btn-load" onclick="loadArticle()">
                <span id="loadButtonText">📰 Load Article</span>
            </button>

            <div id="articleContent"></div>
        </div>

        <div class="chat-container">
            <div class="chat-header">
                <h2>💬 Chat about the Article</h2>
                <div class="chat-status" id="chatStatus">Load an article to start chatting</div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="empty-state">
                    <div class="icon">📄</div>
                    <h3>Ready to analyze!</h3>
                    <p>Load a news article first, then ask me anything about it</p>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="chat-input-wrapper">
                    <textarea 
                        id="chatInput" 
                        class="chat-input" 
                        placeholder="Ask me anything about the article..."
                        disabled
                        rows="1"
                    ></textarea>
                    <button class="btn-send" onclick="sendMessage()" disabled id="sendButton">
                        ➤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentArticle = null;
        let chatHistory = [];

        async function loadArticle() {
            const urlInput = document.getElementById('newsUrl').value.trim();
            const loadButton = document.querySelector('.btn-load');
            const loadButtonText = document.getElementById('loadButtonText');
            const articleContent = document.getElementById('articleContent');
            const chatStatus = document.getElementById('chatStatus');
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');

            if (!urlInput) {
                alert('Please enter a news article URL');
                return;
            }

            // Show loading state
            loadButton.disabled = true;
            loadButtonText.textContent = '🔄 Loading...';
            articleContent.innerHTML = `
                <div class="loading-article">
                    <div class="spinner"></div>
                    <p>Fetching article...</p>
                </div>
            `;
            chatStatus.textContent = 'Loading article...';

            try {
                // Call the actual API
                const response = await fetch('http://localhost:5000/load-article', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: urlInput })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                currentArticle = {
                    url: data.url,
                    title: data.title,
                    summary: data.summary,
                    session_id: data.session_id,
                    content: "Article content loaded for AI analysis..."
                };

                displayLoadedArticle();
                enableChat();
                clearChat();
                
            } catch (error) {
                console.error('Failed to load article:', error);
                articleContent.innerHTML = `
                    <div style="color: #e53e3e; text-align: center; padding: 20px;">
                        ❌ Failed to load article. Please check the URL and try again.<br>
                        <small>Error: ${error.message}</small>
                    </div>
                `;
                chatStatus.textContent = 'Failed to load article';
            } finally {
                loadButton.disabled = false;
                loadButtonText.textContent = '📰 Load Article';
            }
        }

        function displayLoadedArticle() {
            const articleContent = document.getElementById('articleContent');
            articleContent.innerHTML = `
                <div class="article-info">
                    <div class="article-title">${currentArticle.title}</div>
                    <a href="${currentArticle.url}" class="article-url" target="_blank">${currentArticle.url}</a>
                </div>
                <div class="article-summary">${currentArticle.summary}</div>
            `;
        }

        function enableChat() {
            const chatInput = document.getElementById('chatInput');
            const sendButton = document.getElementById('sendButton');
            const chatStatus = document.getElementById('chatStatus');
            
            chatInput.disabled = false;
            sendButton.disabled = false;
            chatStatus.textContent = 'Article loaded! Ask me anything about it';
            chatInput.placeholder = 'Ask me anything about the article...';
            chatInput.focus();
        }

        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatHistory = [];
            chatMessages.innerHTML = `
                <div class="message bot">
                    👋 Hi! I've analyzed the article "${currentArticle.title}". 
                    
                    What would you like to know about it? You can ask about:
                    • Key points and summary
                    • Specific details or statistics
                    • Expert opinions mentioned
                    • Implications and analysis
                    • Comparisons with other topics
                </div>
            `;
        }

        async function sendMessage() {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();
            
            if (!message || !currentArticle) return;

            // Add user message
            addMessage(message, 'user');
            chatInput.value = '';
            autoResizeTextarea(chatInput);

            // Show typing indicator
            showTypingIndicator();

            try {
                // Call the actual chat API
                const response = await fetch('http://localhost:5000/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        session_id: currentArticle.session_id,
                        message: message 
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                hideTypingIndicator();
                addMessage(data.response, 'bot');
                
                // Store in chat history
                chatHistory.push({
                    question: message,
                    answer: data.response,
                    timestamp: new Date()
                });
                
            } catch (error) {
                hideTypingIndicator();
                addMessage('Sorry, I encountered an error while processing your question. Please try again.', 'bot');
                console.error('Chat error:', error);
            }
        }

        function addMessage(content, sender) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            messageDiv.textContent = content;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chatMessages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message typing';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }



        function autoResizeTextarea(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }

        // Event listeners
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('chatInput').addEventListener('input', function() {
            autoResizeTextarea(this);
        });

        document.getElementById('newsUrl').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loadArticle();
            }
        });
    </script>
</body>
</html>